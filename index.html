<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizGenius AI: Solver & Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: #f5f5f7; min-height: 100vh; color: #1d1d1f; position: relative; overflow-x: hidden; }
        .fullscreen { display: none; flex-direction: column; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; text-align: center; padding: 20px; color: white; }
        #namePromptScreen { background: linear-gradient(135deg, #6b48ff, #3498db); z-index: 3000; }
        #welcomeScreen { background: linear-gradient(135deg, #007AFF, #5856D6); z-index: 2000; overflow-y: auto; }
        #mainAppContainer { display: none; max-width: 800px; margin: 0 auto; background: white; min-height: 100vh; box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); }
        .header { background: linear-gradient(135deg, #007AFF, #5856D6); color: white; padding: 15px 20px; text-align: center; position: sticky; top: 0; z-index: 100; display: flex; align-items: center; justify-content: space-between; }
        .header-text { text-align: left; }
        .header h1 { font-size: 22px; }
        #appSubtitle { font-size: 14px; opacity: 0.9; line-height: 1.4; }
        .header-right-controls { display: flex; align-items: center; gap: 15px; }
        .header-controls { display: flex; flex-direction: column; gap: 8px; }
        .header-switch-btn { background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 6px 14px; border-radius: 25px; font-size: 12px; font-weight: 600; cursor: pointer; }
        .main-content { padding: 20px; }
        .solver-mode-switch { display: flex; gap: 10px; margin-bottom: 15px; }
        .solver-mode-switch .mode-btn { flex: 1; padding: 12px; border-radius: 12px; border: 2px solid #007AFF; font-size: 16px; font-weight: 600; cursor: pointer; background-color: #fff; color: #007AFF; }
        .solver-mode-switch .mode-btn.active { background-color: #007AFF; color: #fff; }
        .input-section { background: #f2f2f7; border-radius: 16px; padding: 20px; margin-bottom: 20px; }
        .question-input { width: 100%; min-height: 100px; padding: 15px; border: 1px solid #d1d1d6; border-radius: 12px; font-size: 16px; resize: vertical; }
        .solve-btn { width: 100%; background: linear-gradient(135deg, #007AFF, #5856D6); color: white; border: none; padding: 16px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .loading { display: none; text-align: center; padding: 30px; }
        .loading-spinner { width: 32px; height: 32px; border: 3px solid #f2f2f7; border-top: 3px solid #007AFF; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .result-card { background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: none; margin-top: 20px; }
        /* Add other styles from your original file here if needed */
    </style>
</head>
<body>
    <!-- ALL YOUR HTML Body content from original file goes here -->
    <!-- For brevity, I am omitting the full HTML body, but you should have it -->
    <div id="namePromptScreen" class="fullscreen">
        <h1>Welcome to QuizGenius AI!</h1>
        <p>Let's set up your profile.</p>
        <input type="text" id="nameInput" placeholder="Enter your full name" style="font-size: 20px; padding: 15px 20px; border-radius: 12px; border: 2px solid white; background: rgba(255,255,255,0.2); color: white; text-align: center; width: 100%; max-width: 350px; margin-bottom: 20px;">
        <button id="continueBtn" style="background: white; color: #6b48ff; padding: 15px 40px; border-radius: 12px; font-size: 18px; font-weight: 600; cursor: pointer; border: none;">Continue</button>
        <p style="font-weight: 600; color: white; margin-top: 25px;">This app built by Anish Gupta</p>
    </div>

    <div id="mainAppContainer">
        <div class="header">
            <div class="header-text">
                <h1 id="appTitle">Question Solver AI</h1>
                <p id="appSubtitle"></p>
            </div>
            <div class="header-right-controls">
                <div class="header-controls">
                    <button id="changeUserBtn" class="header-switch-btn">Change User</button>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="solver-mode-switch">
                <button id="textModeBtn" class="mode-btn active">‚úçÔ∏è Text Question</button>
                <button id="imageModeBtn" class="mode-btn">üì∑ Upload Image</button>
                <input type="file" id="imageInput" accept="image/*" style="display: none;">
            </div>
            <div class="input-section">
                <textarea id="questionInput" class="question-input" placeholder="Type your question here..."></textarea>
            </div>
            <button class="solve-btn" id="solveBtn">Solve Question</button>
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>AI is analyzing...</p>
            </div>
            <div class="result-card" id="resultCard">
                <div id="resultContent"></div>
            </div>
        </div>
    </div>

    <script>
    (function() {
        'use strict';

        const App = {
            init() {
                this.cacheDOMElements();
                this.bindEvents();
                this.checkUser();
            },
            cacheDOMElements() {
                this.namePromptScreen = document.getElementById('namePromptScreen');
                this.nameInput = document.getElementById('nameInput');
                this.continueBtn = document.getElementById('continueBtn');
                this.mainAppContainer = document.getElementById('mainAppContainer');
                this.appSubtitle = document.getElementById('appSubtitle');
                this.changeUserBtn = document.getElementById('changeUserBtn');
            },
            bindEvents() {
                this.continueBtn.addEventListener('click', () => this.saveUser());
                this.changeUserBtn.addEventListener('click', () => this.resetUser());
            },
            checkUser() {
                const userName = localStorage.getItem('quizGeniusUserName');
                if (userName) {
                    this.namePromptScreen.style.display = 'none';
                    this.mainAppContainer.style.display = 'block';
                    this.updateHeader(userName);
                    SolverApp.init(); // Initialize SolverApp only if user exists
                } else {
                    this.namePromptScreen.style.display = 'flex';
                    this.mainAppContainer.style.display = 'none';
                }
            },
            saveUser() {
                const userName = this.nameInput.value.trim();
                if (userName) {
                    localStorage.setItem('quizGeniusUserName', userName);
                    this.checkUser();
                } else {
                    alert('Please enter your name!');
                }
            },
            resetUser() {
                if (confirm('Are you sure you want to change user? This will clear your name.')) {
                    localStorage.removeItem('quizGeniusUserName');
                    window.location.reload();
                }
            },
            updateHeader(name) {
                const firstName = name.split(' ')[0];
                this.appSubtitle.textContent = `Welcome, ${firstName}!`;
            }
        };

        const SolverApp = {
            init() {
                this.cacheDOMElements();
                this.bindEvents();
            },
            cacheDOMElements() {
                this.questionInputEl = document.getElementById('questionInput');
                this.solveBtn = document.getElementById('solveBtn');
                this.loadingEl = document.getElementById('loading');
                this.resultCardEl = document.getElementById('resultCard');
                this.resultContentEl = document.getElementById('resultContent');
                this.imageInputEl = document.getElementById('imageInput');
                this.imageModeBtn = document.getElementById('imageModeBtn');
                this.textModeBtn = document.getElementById('textModeBtn');
            },
            bindEvents() {
                this.solveBtn.addEventListener('click', () => this.solveQuestion());
                this.imageModeBtn.addEventListener('click', () => this.imageInputEl.click());
            },
            async solveQuestion() {
                const questionText = this.questionInputEl.value.trim();
                if (!questionText) {
                    alert('Please enter a question!');
                    return;
                }
                this.loadingEl.style.display = 'block';
                this.resultCardEl.style.display = 'none';
                
                const parts = [{ text: questionText }];

                try {
                    // This URL points to your own server function
                    const url = '/api/solve';

                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        // The body is exactly what your server function will forward to Google
                        body: JSON.stringify({ contents: [{ parts: parts }] })
                    });

                    if (!response.ok) {
                        // If the server responds with an error (like 404, 500), this will catch it
                        const errorData = await response.json();
                        throw new Error(`Error from server: ${errorData.error || response.statusText}`);
                    }

                    const data = await response.json();
                    
                    if (data.error) {
                         throw new Error(`API Error: ${data.error.message}`);
                    }
                    if (!data.candidates || data.candidates.length === 0) {
                        throw new Error("No response from AI. The content may have been blocked.");
                    }

                    const answer = data.candidates[0].content.parts[0].text;
                    this.resultContentEl.innerHTML = answer.replace(/\n/g, '<br>');

                } catch (error) {
                    console.error('An error occurred:', error);
                    this.resultContentEl.textContent = `Sorry, an error occurred. Please check the configuration and try again. Reason: ${error.message}`;
                } finally {
                    this.loadingEl.style.display = 'none';
                    this.resultCardEl.style.display = 'block';
                }
            }
        };

        // Initialize the main App on page load
        App.init();

    })();
    </script>
</body>
</html>
